# 1. Gradle 빌드
./gradlew :hexagonal-payment:clean :hexagonal-payment:build -x test

# 2. Docker 이미지 재빌드
cd hexagonal-payment
docker build -t hexagonal-payment:1.0.0 .
cd ..

# 3. Deployment 재시작
kubectl rollout restart deployment/hexagonal-payment -n payment

# 4. 로그 확인
kubectl logs -f -n payment -l app=hexagonal-payment

# xx. configMap 확인
kubectl get configmap hexagonal-payment-config -n payment -o yaml


# Pod에서 실제 환경 변수 확인
kubectl exec -n payment -it $(kubectl get pod -n payment -l app=hexagonal-payment -o jsonpath='{.items[0].metadata.name}') -- env | grep SPRING

## 초기화

### 모든 리소스 삭제
kubectl delete deployment hexagonal-payment -n payment
kubectl delete service hexagonal-payment -n payment
kubectl delete configmap hexagonal-payment-config -n payment
kubectl delete secret hexagonal-payment-secret -n payment

### 완전히 삭제될 때까지 대기
sleep 10

### 적용
kubectl apply -f k8s/hexagonal-payment/configmap.yaml
kubectl apply -f k8s/hexagonal-payment/secret.yaml
kubectl apply -f k8s/hexagonal-payment/deployment.yaml
kubectl apply -f k8s/hexagonal-payment/service.yaml

kubectl logs -f -n payment -l app=hexagonal-payment

