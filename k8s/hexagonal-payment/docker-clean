#!/bin/bash
# docker-clean.sh

echo "ğŸ³ === Docker ì´ë¯¸ì§€ ê´€ë¦¬ ==="
echo ""

# ìƒ‰ìƒ
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

# 1. ì „ì²´ ì´ë¯¸ì§€ ëª©ë¡
echo -e "${BLUE}ğŸ“¦ ì „ì²´ Docker ì´ë¯¸ì§€:${NC}"
docker images
echo ""

# 2. hexagonal-payment ì´ë¯¸ì§€ë§Œ í•„í„°ë§
echo -e "${YELLOW}ğŸ” hexagonal-payment ì´ë¯¸ì§€:${NC}"
IMAGES=$(docker images | grep hexagonal-payment)

if [ -z "$IMAGES" ]; then
    echo -e "${GREEN}âœ… hexagonal-payment ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.${NC}"
    exit 0
fi

echo "$IMAGES"
echo ""

# 3. ì‚­ì œ ì˜µì…˜ ì„ íƒ
echo -e "${BLUE}ì‚­ì œ ì˜µì…˜:${NC}"
echo "1) hexagonal-payment:1.0.0 ë§Œ ì‚­ì œ"
echo "2) hexagonal-payment:latest ë§Œ ì‚­ì œ"
echo "3) ëª¨ë“  hexagonal-payment ì´ë¯¸ì§€ ì‚­ì œ"
echo "4) Dangling ì´ë¯¸ì§€ ì‚­ì œ (<none>:<none>)"
echo "5) ëª¨ë“  ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ë¯¸ì§€ ì‚­ì œ"
echo "0) ì·¨ì†Œ"
echo ""

read -p "ì„ íƒ (0-5): " choice

case $choice in
    1)
        echo -e "${RED}ğŸ—‘ï¸  hexagonal-payment:1.0.0 ì‚­ì œ ì¤‘...${NC}"
        docker rmi hexagonal-payment:1.0.0
        ;;
    2)
        echo -e "${RED}ğŸ—‘ï¸  hexagonal-payment:latest ì‚­ì œ ì¤‘...${NC}"
        docker rmi hexagonal-payment:latest
        ;;
    3)
        echo -e "${RED}ğŸ—‘ï¸  ëª¨ë“  hexagonal-payment ì´ë¯¸ì§€ ì‚­ì œ ì¤‘...${NC}"
        docker rmi -f $(docker images | grep hexagonal-payment | awk '{print $3}')
        ;;
    4)
        echo -e "${RED}ğŸ—‘ï¸  Dangling ì´ë¯¸ì§€ ì‚­ì œ ì¤‘...${NC}"
        docker image prune -f
        ;;
    5)
        echo -e "${RED}ğŸ—‘ï¸  ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ëª¨ë“  ì´ë¯¸ì§€ ì‚­ì œ ì¤‘...${NC}"
        docker image prune -a -f
        ;;
    0)
        echo -e "${GREEN}âœ… ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.${NC}"
        exit 0
        ;;
    *)
        echo -e "${RED}âŒ ì˜ëª»ëœ ì„ íƒì…ë‹ˆë‹¤.${NC}"
        exit 1
        ;;
esac

echo ""
echo -e "${GREEN}âœ… ì™„ë£Œ!${NC}"
echo ""

# 4. ìµœì¢… ê²°ê³¼
echo -e "${BLUE}ğŸ“¦ ë‚¨ì€ ì´ë¯¸ì§€:${NC}"
docker images
